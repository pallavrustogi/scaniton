<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Bootstrap, from Twitter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Le styles -->
    <!-- TODO: make sure bootstrap.min.css points to BootTheme generated file
        -->
    <link href="bootstrap.min.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }
		.buttonLink{
			background: transparent;
			border: transparent;
			color: blue;
			text-decoration: underline;
		}
    </style>
    <!-- TODO: make sure bootstrap-responsive.min.css points to BootTheme
        generated file -->
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    <!-- Fav and touch icons -->
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
	<script src="http://www.parsecdn.com/js/parse-1.2.12.min.js"></script>
	
</head>

<body>
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container-fluid">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>

                </a>
                <a class="brand" href="#">Scaniton</a>
                <div class="nav-collapse collapse">
                    <p class="navbar-text pull-right">Logged in as
                        <a id="user" href="#" class="navbar-link"></a>
                    </p>
                    <ul class="nav">
                        <li class="active">
                            <a href="index.html">Home</a>
                        </li>
                        <li>
                            <a href="index.html#features">About</a>
                        </li>
                        <li>
                            <a href="index.html#faq">Contact</a>
                        </li>
                    </ul>
                </div>
                <!--/.nav-collapse -->
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span3">
                <div class="well sidebar-nav">
                    <ul class="nav nav-list">
                        <li class="nav-header">To Do</li>
                        <li>
                            <a href="profile.html">Create New</a>
                        </li>
                        <li class="active">
                            <a href="#">Track Packages</a>
                        </li>
                        <li>
                            <a href="#"></a>
                        </li>

                    </ul>
                </div>
                <!--/.well -->
            </div>
            <!--/span-->
            <div class="span9">
                <div class="hero-unit">
                    <h1>Your Packages</h1>
					<div id="main">
					</div>

                </div>

                <!--/row-->
            </div>
            <!--/span-->
        </div>
        <!--/row-->
        <hr>
        <footer>
            <p>Â© Scaniton 2013. QR Code is a registered trademark of DENSO WAVE INCORPORATED
            </p>
        </footer>
    </div>
    <!--/.fluid-container-->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
	<script type="text/javascript" src="js/jquery.tablesorter.min.js"></script> 
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="jquery.qrcode.min.js"></script>
	<script type="text/javascript">
		Parse.initialize("SN9RAjbHn5ofcwqjshAYG0jRZnxQrMgZ6Xj3rJWh", "HX9VdqSqHXGxBQqXMBFBCASVLUiWrkAC2WPI1Pcb");
</script>
<script type = "text/javascript">
	$(document).ready(function(){
				var currentUser = Parse.User.current();
				if (currentUser) {
				console.log(currentUser.attributes.full_name);
				$("#user").html(currentUser.attributes.full_name);
				var QrUrl = Parse.Object.extend("qr_url");
				var query = new Parse.Query(QrUrl);
				var htmlContent="";
				query.equalTo("createdBy", currentUser);
				query.include("createdBy");
				
				query.find({
				  success: function(results) {
					//alert("Successfully retrieved " + results.length + " scores.");
					// Do something with the returned Parse.Object values
					htmlContent="";
					for (var i = 0; i < results.length; i++) { 
					  var object = results[i];
					  console.log(object);
					  var qr_log = Parse.Object.extend("qr_logger");
					  var query = new Parse.Query(qr_log);
					  query.equalTo("qrid", object);
					  query.include("createdBy");
					  query.include("qrid");
					  htmlContent+="<tr><td>"+object.get("title")+"</td><td>"+"Created"+"</td><td>"+object.createdAt+"</td><td>"+object.get("createdBy").get("full_name")+"</td></tr>";
					  query.find({
						success: function(result) {
						//alert("Successfully retrieved " + results.length + " scores.");
						// Do something with the returned Parse.Object values
						  for (var i = 0; i < result.length; i++) { 
							  var obj = result[i];
							  try{
							  var user_id = obj.get("createdBy").get("full_name");
							  console.log(user_id);
							  }
							  catch(err){
							  user_id="unknown";}
							  console.log(object);
							  
							  var dated = obj.updatedAt;
							  console.log(dated.getFullYear());
							 // username = getUsername(user_id);
							 // console.log(username);
							  htmlContent+="<tr><td>"+obj.get("qrid").get("title")+"</td><td>"+"Scanned"+"</td><td>"+dated+"</td><td>"+user_id+"</td></tr>";				  
						}
						$("#main").html("<table border=\"1\" id=\"myTable\" class=\"table table-bordered table-striped\" style=\"margin-top: 15px\"><tr><th>Name</th><th>Status</th><th>Date/Time</th><th>Signature</th></tr>"+htmlContent+"</table>");
						
					  }
					  });
					  $("#main").html("<table border=\"1\" id=\"myTable\" class=\"table table-bordered table-striped\" style=\"margin-top: 15px\"><tr><th>Name</th><th>Status</th><th>Date/Time</th><th>Signature</th></tr>"+htmlContent+"</table>");
					  $("#myTable").tablesorter(); 
					}
					
				  },
				  error: function(error) {
					alert("Error: " + error.code + " " + error.message);
				  }
				});
				//$("#main").on('click', 'a', function(){
				//$(this).html("hello!! Under construction");});
				//}else
				//{console.log("no user");}
				}
			});
			$(document).ready(function() 
				{ 
					$("#myTable").tablesorter(); 
				} 
			); 
			
			function track(packId)
			{
				
				var qr_log = Parse.Object.extend("qr_logger");
				
				var query = new Parse.Query(qr_log);
				
				var htmlVal="";
				var username="";
				var temp = "#" + packId;
				query.equalTo("qrid", packId);
				query.find({
				  success: function(results) {
					//alert("Successfully retrieved " + results.length + " scores.");
					// Do something with the returned Parse.Object values
					for (var i = 0; i < results.length; i++) { 
					  var object = results[i];
					  var user_id = object.get("createdBy").id;
					  username = getUsername(user_id);
					  console.log(username);
					  htmlVal+="<li>"+username+"</li>";					  
					}
					
					
					$(temp).parent().html($(temp).parent().html() + "<ul>"+htmlVal+"</ul>");
				  },
				  error: function(error) {
					alert("Error: " + error.code + " " + error.message);
				  }
				});
				
			}
			
			function getUsername(user_id)
			{
					  var usr = Parse.Object.extend("User");
					  var user = new Parse.Query(usr);
					  var username="";
					  user.equalTo("objectId",user_id);
					  user.find().then({
					  success: function(res){
						var obj = res[0];
						username=obj.get("username");
						//alert(username);
						return "hello";
					  },
					  error: function(error){
					   console.log("error");
					  }
					  });
					  //alert(username);
					  
			}
	</script>
	
	
	
	
</body>

</html>